---
title: "Can Bitcoin be an alternative hedge to gold in a recession?"
author: Alf Henrik Heggelund, Fredrik Sverre Nilssen & Andreas Reiten Skundberg
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    smooth_scroll: false
    toc_depth: 3
runtime: shiny
date: "`r format(Sys.time(), '%d %B %Y')`"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(httr)
library(readr)
library(quantmod)
library(lubridate)
library(Quandl)
library(PerformanceAnalytics)
library(xts)
library(tidyquant)
library(cranlogs)   # For inspecting package downloads over time
library(corrr)      # Tidy correlation tables and correlation plotting
library(cowplot) 

library(gtrendsR) # Download Google Data


```


&nbsp;
&nbsp;
&nbsp;


![Bitvoin bilde](https://thumbor.forbes.com/thumbor/960x0/https%3A%2F%2Fspecials-images.forbesimg.com%2Fdam%2Fimageserve%2F908633080%2F960x0.jpg%3Ffit%3Dscale)
Picture source:https://www.forbes.com/sites/forbesfinancecouncil/2018/12/05/the-top-10-risks-of-bitcoin-investing-and-how-to-avoid-them/?sh=55fff8a52407
&nbsp;
&nbsp;
&nbsp;
&nbsp;

##### Hvordan har avkastningen til Bitcoin hvert mot andre assets? Kan bitcoin være en safehaven eller en hedge mot dårligere tider?

&nbsp;
&nbsp;
&nbsp;
&nbsp;


### Overview and Motivation 
Provide an overview of the project goals and the motivation for it. Consider that this will be read by people who did not see your project proposal.

Our group consist of three economics student that wanted to explore an issue related to economics. Rather than reexploring traditional economical facts or a well-established phenomenon we set out to uncover a somewhat unexplored issue. An issue that might be more evident during the recent economic recession caused by the 2020 Pandemic. 

This recession, as well as any other makes the phenomenon of safe havens resurface. Financial safe havens are assets that retain or increases in value during an economic downturn. Examples of proven safe havens would be precious metals like gold, currencies as the US dollar, swiss franc and the Japanese yen, or government bonds. 

With the rising popularity of cryptocurrencies over the past years we set out to investigate whether cryptocurrencies, particularly Bitcoin had become a safe haven during the Covid-19 recession. 

The underlying motivation for choosing this issue for the data science project was our own experience during the covid-19 recession. As amateur investors in the stock market and cryptocurrencies we experienced the market downswing first-hand as our portfolio decreased in value. Therefore, we were left wondering whether redirecting investments towards bitcoin would prove be a beneficial hedge and risk diversification. 

With our newfound knowledge and ability to use data science to investigate this issue, we wanted to create a reliable report answering this question. By analysing and visualising accessible data we would prove or disprove our initial hypothesis. 





&nbsp;
&nbsp;
&nbsp;
&nbsp;

### Related Work
Anything that inspired you, such as a paper, a web-site, or something we discussed in class.

The safe haven properties of cryptocurrencies have been the inspiration of several studies, and the pandemic and the following market turbulence marked the first opportunity to examine this properly. 

Bitcoin as a decentralized digital currency with limited supply have already been labelled a safe haven by some investors. 
The American investor Tyler Winklevoss tweeted on the 27th of February 2020.

[“At some point people will wake up and realize that bitcoin is the best safe haven asset the world has ever seen. Until then, opportunity abounds.”
 ](https://twitter.com/tyler/status/1232875921025249280) 

&nbsp;
&nbsp;
&nbsp;
&nbsp;

### Initial Questions
What questions are you trying to answer? How did these questions evolve over the course of the project? What new questions did you consider in the course of your analysis?

The key issue in this report whether Bitcoin have become a safe haven. Before analysing the data, it would be helpful to see if Bitcoin possess the characteristics of a safe haven asset. 
Safe havens have:

High liquidity: It easily can be converted into cash. 

Limited supply: Maintains its value due to the scarcity of the asset.

Sustained demand: The asset keeps it high demand.

Long term performance: The assets utilization is upheld long term 

Persistence: The assets quality does not decline

Bitcoin do hold these characteristics. Bitcoin maintains a high trade volume, with low fees and a market that is always open. The Bitcoin supply is limited to 21 million in total and will undoubtedly be less than its demand. Bitcoin continues to be the leader in the cryptocurrency market and is expected to maintain this position. The utilization of the asset is still somewhat unclear as investor tends to hold their investment rather than spending it. 
Finally, the quality of digital currency does not decline in any way.    

Now that the safe haven properties of bitcoin have been cleared, the overall evaluation of bitcoin remained. Prior to further analysing bitcoin as a safe haven, we wanted a complete overview of Bitcoin as an investment. Answering questions like:

What were the rate of returns of Bitcoin compared to other assets? 
How did it compare to rivaling cryptocurrencies, the overall stock market, or a safe haven asset such as gold?  
What is the risk involved with these investments?
How to these markets act in times of market turbulence and expected volatility? 
Is bitcoin a valuable investment, and how have the rates of return developed?
Furthermore, who are investing in Bitcoin? Are bitcoin investors amateurs jumping the bandwagon on a hype without a clear understanding of its qualities and value. Or calculated investors making larger investments envisioning a steady rate of return and future performance.  

These questions require different approaches and a variety data to be analysed. This report will provide an overall assessment of bitcoins progress, qualities and its response to market volatility. Over the course of the project our initial question became part of a bigger analysis, which aimed to be as objective as possible. 



&nbsp;
&nbsp;
&nbsp;
&nbsp;



&nbsp;
&nbsp;
&nbsp;
&nbsp;

```{r message=FALSE, echo=FALSE}

### Importing Data

# Getting data from Quandl API.
Gold <-Quandl("LBMA/GOLD", api_key="4TmA83fLoY_UpQJVjVJu", start_date="2016-01-04", end_date="2022-01-01")
# Selecting culumns and renameing
Gold <- Gold %>% select("Date", "USD (PM)") %>% rename(Price = "USD (PM)")
# Removing N/A values
Gold <- na.omit(Gold)

# Getting data from yahoo
ETH <- getSymbols("ETH-USD", auto.assign=FALSE, from="2016-01-04", src='yahoo')
BTC <- getSymbols("BTC-USD", auto.assign=FALSE, from="2016-01-04", src='yahoo')
SP500 <- getSymbols("^GSPC", auto.assign=FALSE, from="2016-01-04", src='yahoo') 
VIX <- getSymbols("^VIX", auto.assign=FALSE, from="2016-01-04", src='yahoo') 

# Making data from xts to normal df. Picking columns and renameing.
ETH <- zoo::fortify.zoo(ETH)
ETH <- ETH %>% select("Index","ETH-USD.Close") %>% mutate(Asset = "Ethereum") %>% rename(Date ="Index", Price = "ETH-USD.Close")

BTC <- zoo::fortify.zoo(BTC)
BTC <- BTC %>% select("Index","BTC-USD.Close") %>% mutate(Asset = "Bitcoin") %>% rename(Date ="Index", Price = "BTC-USD.Close")

SP500 <- zoo::fortify.zoo(SP500)
SP500 <- SP500 %>% select("Index","GSPC.Close") %>% mutate(Asset = "S&P500") %>% rename(Date ="Index", Price = "GSPC.Close")

VIX <- zoo::fortify.zoo(VIX)
VIX <- VIX %>% select("Index","VIX.Close") %>% mutate(Asset = "VixIndex") %>% rename(Date ="Index", Price = "VIX.Close")

### Making data from daily to weekly form

# Making new variable that sorts weekly
BTC$week <- floor_date(BTC$Date, "week")
# Grouping then new variable week and taking the mean to get weekly price. 
BTC <- BTC %>%
  group_by(week) %>%
  summarize(mean = mean(Price)) %>% 
 #Renameing and mutating in a new column that is called Asset and is filled with Bitcoin
  rename(Price = "mean") %>% mutate(Asset = "Bitcoin")

#
ETH$week <- floor_date(ETH$Date, "week")
# 
ETH <- ETH %>%
  group_by(week) %>%
  summarize(mean = mean(Price)) %>% 
  rename(Price = "mean") %>% mutate(Asset = "Ethereum")

#
SP500$week <- floor_date(SP500$Date, "week")
#
SP500 <- SP500 %>%
  group_by(week) %>%
  summarize(mean = mean(Price))%>% rename(Price = "mean") %>% mutate(Asset = "SP500")

# 
Gold$week <- floor_date(Gold$Date, "week")
#
Gold <- Gold %>%
  group_by(week) %>%
  summarize(mean = mean(Price)) %>% rename(Price = "mean") %>% mutate(Asset = "Gold")

# 
VIX$week <- floor_date(VIX$Date, "week")
#
VIX <- VIX %>%
  group_by(week) %>%
  summarize(mean = mean(Price)) %>% rename(Price = "mean") %>% mutate(Asset = "VIX")

### Taking weekly logarithmic return

# Making logarithmic percentage change from week to week
log_returns <- diff(log(ETH$Price), lag=1)
# Making log_returns to a dataframe
log_returns <- cbind(log_returns)
# Putting 0 at the top of log_returns, to make it same length as other variables
log_returns <- rbind(0,log_returns)
#Binding log_returns togheter with main df
ETH <- cbind(ETH, log_returns)

#
log_returns <- diff(log(BTC$Price), lag=1)

log_returns <- cbind(log_returns)

log_returns <- rbind(0,log_returns)

BTC <- cbind(BTC, log_returns)

#
log_returns <- diff(log(SP500$Price), lag=1)

log_returns <- cbind(log_returns)

log_returns <- rbind(0,log_returns)

SP500 <- cbind(SP500, log_returns)

#
log_returns <- diff(log(Gold$Price), lag=1)

log_returns <- cbind(log_returns)

log_returns <- rbind(0,log_returns)

Gold <- cbind(Gold, log_returns)

#
log_returns <- diff(log(VIX$Price), lag=1)

log_returns <- cbind(log_returns)

log_returns <- rbind(0,log_returns)

VIX <- cbind(VIX, log_returns)

# Making data long
df <- bind_rows(ETH,BTC,SP500,Gold,VIX)

# Making log_returns cumulative
df <- df %>% group_by(Asset)%>% mutate(cumulative = cumsum(log_returns))

```


```{r message=FALSE, echo=FALSE}
# Filter for year 2020
ETH2020 <- ETH %>% filter(week>= "2020-01-01")
BTC2020 <- BTC %>% filter(week>= "2020-01-01")
Gold2020 <- Gold %>% filter(week>= "2020-01-01")
SP500_2020 <- SP500 %>% filter(week>= "2020-01-01")

###Taking weekly logarithmic return of all df

log_returns2 <- diff(log(BTC2020$Price), lag=1)

log_returns2 <- cbind(log_returns2)

log_returns2 <- rbind(0,log_returns2)

BTC2020 <- cbind(BTC2020, log_returns2)
# 
log_returns2 <- diff(log(Gold2020$Price), lag=1)

log_returns2 <- cbind(log_returns2)

log_returns2 <- rbind(0,log_returns2)

Gold2020 <- cbind(Gold2020, log_returns2)
# 
log_returns2 <- diff(log(SP500_2020$Price), lag=1)

log_returns2 <- cbind(log_returns2)

log_returns2 <- rbind(0,log_returns2)

SP500_2020 <- cbind(SP500_2020, log_returns2)

# Making data long
df2<-bind_rows(BTC2020,Gold2020,SP500_2020)
# Making cumulative
df2 <- df2 %>% select(week,Price,Asset,log_returns2) %>% group_by(Asset)%>% mutate(cumulative = cumsum(log_returns2))
```

### Data
Source, scraping method, cleanup, etc.

Finding data on this topic initially seemed like a manageable task. Cryptocurrency and other financial markets rely on constant flow of publicly accessible data to function properly. 
Using APIs was the preferred method but found several obstacles which complicated the process. Some APIs costs money and others proved difficult to operate. 

Yahoo finance is a financial platform that provide reliable reports and a global following. Yahoo finance gave access to CSV-files on the S&P 500, Bitcoin, Ethereum and VIX-index.
By use of the correct R-code opened up the possibility to import these files directly into R-studio. This makes the report more user-orientated and also creates a dynamic code.  
The data set received from Yahoo on gold prices revealed several gaps. Involving missing dates and values. We deemed it unusable and had to revisit the application of APIs. 
Through Quandl it was manageable to make use of an API and retrieve data on gold from the London Bullion Market. 

The data acquired from Yahoo finance came in a xts-format. Which made the date variable appear in a POXEIT-format. This format was somewhat new to us, but by use of the Zoo package we managed to transform it into a format more suited for our abilities. 

After the data was in the correct formats, we used the dplyr package to manipulate and create pipeline for the data. The data frames contained variables irrelevant to the analysis. These variables were removed by choosing columns with the select function. Then adding new variables to specify each asset. This makes it more convenient to plot the data frame later. 

An obstacle when comparing cryptocurrency markets to other financial markets is that normal markets have limited trading hours and closed during the weekend. The cryptocurrency market is unlimited and open all year. Observations for Bitcoin and Ethereum exceeded the observations for gold and the S&P 500 and VIX-indexes. This obstacle was solved manipulation the data into weekly observations. By creating a mean of all the daily data with the summarize function within a week to generate a weekly price. The floor_date function made this possible, which makes all values within a week set to the same date assigned to a week variable. Then applying the group_by function arrange the data. 

The data frame from the London Bullion Market contained several N/A values. Removing these was done with the omit function. 

To visualise the rate of returns cumulatively it was necessary to calculate the logarithmic returns each week. By dividing the log of the first observation by the log of the following observation. (Log observation 1/ log observation 2). Then recreating the data frame using cbind. To do this it was necessary to use rbind function to enter an observation zero, to be able to connect the original data frame with the logarithmic returns. 
Eventually using the cumsum function to summarise all grouped assets up against the logarithmic returns. Now all the data is cumulative, and it is possible to compare the returns of each asset.


### Exploratory Analysis

Beginning with an examination of the cumulative growth in the chosen markets. Starting in 2016 the illustration shows the cumulative returns of Bitcoin, Ethereum, Gold, S&P 500 and the VIX-index. These assets were chosen for several comparative reasons. Ethereum which is a rivaling cryptocurrency have been included as an alternative investment in the cryptocurrency market. Gold as an asset is a well-established safe haven and has maintained its value over a long term. The S&P 500 is a stock index measuring the performance of the 500 largest companies listed on the American stock exchanges. It includes companies like Apple, Amazon, JP Morgan Chase etc. Representing a broad selection of American industries and works as an indicator for the overall economy. Lastly, the Cboe Volatility Index is included in the analysis. Abbreviated to VIX, it represents market expectations for volatility and is an indicator for market risk. 

Looking at the entire four-year period it displays the two cryptocurrencies as the investments with highest returns. Ethereum leading the race by a margin nearly double bitcoins performance.  The rate of returns in S&P 500 and gold is shown to been minor in comparison. Nevertheless, has a greater degree of stability in its performance. The most notable growth in VIX is at the entry of 2020. Naturally the covid-19 pandemic created financial turbulence on a global scale and would be the explanation for the rapid growth in market volatility. 

The illustration shows that both Bitcoin and Ethereum are corelated with market trends. As the VIX has increased growth traditional financial assets should experience reduced growth. The only asset not showing this inverse correlation is gold. 

```{r message=FALSE, echo=FALSE}
# Plotting
p<-df %>% 
  ggplot(aes(x=week, y=cumulative, group=Asset)) +
  geom_line(aes(color=Asset))+
  ylab(expression("Change on cumulative form")) +
  xlab("Date") +
  labs(title = "Logarithmic return on cumulativ form from 2016-2020",
       subtitle = "",
       caption = "")+theme(plot.title = element_text(hjust = 0.5))

p
```

#### When did you invest?

The rate of returns received in these assets vary considerably on when the investment occurred. If the investment took place at the start of the period, the returns would be identical to the original illustration. But if the investment was placed on different dates within this period the performance fluctuates significantly. Ethereum which yields the highest returns in the overall period, is shown to be the weakest performer when isolating the period from 2018-2020. 


```{r message=FALSE, echo=FALSE,warning=FALSE}
ui <- fluidPage(
  titlePanel(title=h4("ASSET", align="center")),
  sidebarLayout(
    sidebarPanel( 
      sliderInput("df", "Dates:",min = as.Date("2016-01-01","%Y-%m-%d"), max = as.Date(Sys.time(),"%Y-%m-%d"),value=c(as.Date("2016-01-01"),as.Date("2018-12-01")),timeFormat="%Y-%m-%d")),mainPanel(plotOutput("plot2"))))


server <- function(input,output){
  
  #dat <- reactive({df[df$week %in% seq(from=min(df$week),to=max(df$week),by=1),]})
  dat <- reactive({
    test <- df[df$week %in% seq(from=min(input$df),to=max(input$df),by=1),]
    print(test)
    test
  })
  
  output$plot2<-renderPlot({
    req(dat())
    ggplot(data=dat()%>%
             group_by(Asset)%>% 
             mutate(culinteractive=cumsum(log_returns)- lag(1, default = first(log_returns))),
           aes(x=week,y=culinteractive),group=Asset)+geom_line(aes(color=Asset))},height = 300,width = 500)}
shinyApp(ui, server)


```


### Risk Assessment 

A part of the overall evaluation in the particular investments and one of our initial questions involve an assessment of risk. What is the undertaken risk when investing in these assets?
To measure the risk of an investment there are several statistical and financial methods available. The methodology chosen for risk assessment of the above-mentioned assets in this report have been through coefficient of variation. This measures the dispersion of the data from its mean.  The coefficient of variation is helpful to determine the amount of risk and volatility in comparison to its rate of return

When measuring the coefficient of variation, it shows the tradeoff between risk and return. A high coefficient of variation indicates an asset that has higher degree of volatility but simultaneously produces a higher return. Such an investment would be suitable for a risk-taking investor. On the contrary a low coefficient of variation point to an asset with historically a low degree of risk relative to return. Suitable for a risk adverse investor. 
In the analysis the coefficient of variation are relative measurements. This places the values on a range from 0-100.    

#### 2016-2020



Coefficients of variation (relative variance):

**Relativ varians for Bitcoin:** `r raster::cv(BTC$Price) ` 

**Relativ varians for Ethereum:** `r raster::cv(ETH$Price) ` 

**Relativ varians for Gold:** `r raster::cv(Gold$Price) ` 

**Relativ varians for S&P500:** `r raster::cv(SP500$Price) ` 


When calculating the coefficients of variation of the assets in the entire period it becomes evident that both Bitcoin and Ethereum have a high degree of volatility. The initially lucrative rates of return come with associated risks. Gold and the S&P 500 have substantially lower coefficient of variation, indicating a greater degree of stability.. It is worth noting that coefficient of variation of gold and the S&P 500 are nearly equivalent. Thus being similiar in the risk return tradeoff.   

```{r message=FALSE, echo=FALSE, warning=FALSE}

### Rolling and static correlation 2016-2020

# Making data long and selecting columns
df3 <- bind_rows(ETH,BTC,Gold,VIX) %>% select(week,Price,Asset)
# Selecting columns
SP500_1 <- SP500 %>% select(week,Price)

# Asset Returns
df3 <- df3 %>%
  group_by(Asset) %>%
  tq_transmute(select     = Price, 
               mutate_fun = periodReturn,
               period     = "weekly")

# Baseline Returns
SP500_1 <- SP500_1 %>%
  tq_transmute(select     = Price, 
               mutate_fun = periodReturn,
               period     = "weekly")

# Correlation table
tidyverse_static_correlations2 <- df3 %>%
  # Data wrangling
  spread(key = Asset, value = weekly.returns) %>%
  left_join(SP500_1, by = "week") %>%
  rename(SP500 = weekly.returns) %>%
  select(-week) %>%
  # Correlation and formating
  correlate() 

# Get rolling correlations
tidyverse_rolling_corr2 <- df3 %>%
  # Data wrangling
  left_join(SP500_1, by = "week") %>%
  select(week,Asset, weekly.returns.x, weekly.returns.y ) %>%
  # Mutation
  tq_mutate_xy(
    x          = weekly.returns.x,
    y          = weekly.returns.y,
    mutate_fun = runCor, 
    # runCor args
    n          = 12,
    use        = "pairwise.complete.obs",
    # tq_mutate args
    col_rename = "rolling_corr"
  )

# Wrangling static correlation
tidyverse_static_correlations2 <- tidyverse_static_correlations2 %>%
  select(term, SP500) %>%
  rename(Asset = term)

# Left joining the static correlation to the rolling correlation df
tidyverse_rolling_corr2 <- tidyverse_rolling_corr2 %>%
  left_join(tidyverse_static_correlations2, by = "Asset") %>%
  rename(static_corr = SP500)

# Plot
tidyverse_rolling_corr2 %>%
  ggplot(aes(x = week, color = Asset)) +
  # Data
  geom_line(aes(y = static_corr), color = "red") +
  geom_line(aes(y = rolling_corr), alpha = 0.5) +
  facet_wrap(~ Asset, ncol = 2, scales = "free_y") +
  # Aesthetics
  scale_color_tq() +
  labs(
    title = " S&P500: 12-Weeks Rolling Correlations, SP500 vs assets",
    subtitle = "Relationships are dynamic vs static correlation (red line)",
    x = "", y = "Correlation"
  ) +
  theme_tq() +
  theme(legend.position="none")

```


#### 2020
When only looking at the year 2020 it shows lower coefficients of variation on all investments. This 

Her har vi kjørt korrelsasjon mellom Bitcoin og den nevnte Asset klassen nedenfor:




Korrelsasjonen vi har gjørt mellom Bitcoin og S&P500 indexen i tidsrommet 2016 til dagens dato har vi funnet at de korrelerer veldig høyt. Gull og S&P500 korrelerer også høyt men lavere enn Bitcoin/S&P500. Slik at ut i fra disse tallene ser det ikke ut som at Bitcoin kan være en bedre hedge/diversifisering en gold kun med tanke på risiko. Dette resultat kan være anerledes om vi ser på andre år eksplisit.



### Risk measurment 2020


Coefficients of variations for the year 2020 (relative variance):

**Relative variance for Bitcoin:** `r raster::cv(BTC2020$Price) ` 

**Relative variance for Ethereum:** `r raster::cv(ETH2020$Price) ` 

**Relative variance for Gold:** `r raster::cv(Gold2020$Price) ` 

**Relative variance for S&P500:** `r raster::cv(SP500_2020$Price) ` 

 
### Correlation

These graphs are showing Correlation between weekly-return.


```{r message=FALSE, echo=FALSE, warning=FALSE}

### Rolling and static correlation 2020

# Correlation table
tidyverse_static_correlations3 <- df3 %>% filter(week>= "2020-01-01") %>%
  # Data wrangling
  spread(key = Asset, value = weekly.returns) %>%
  left_join(SP500_1, by = "week") %>%
  rename(SP500 = weekly.returns) %>%
  select(-week) %>%
  # Correlation and formating
  correlate() 

# Get rolling correlations
tidyverse_rolling_corr3 <- df3 %>% filter(week>= "2020-01-01") %>%
  # Data wrangling
  left_join(SP500_1, by = "week") %>%
  select(week,Asset, weekly.returns.x, weekly.returns.y ) %>%
  # Mutation
  tq_mutate_xy(
    x          = weekly.returns.x,
    y          = weekly.returns.y,
    mutate_fun = runCor, 
    # runCor args
    n          = 4,
    use        = "pairwise.complete.obs",
    # tq_mutate args
    col_rename = "rolling_corr"
  )

# Join static correlations with rolling correlations
tidyverse_static_correlations3 <- tidyverse_static_correlations3 %>%
  select(term, SP500) %>%
  rename(Asset = term)

tidyverse_rolling_corr3 <- tidyverse_rolling_corr3 %>%
  left_join(tidyverse_static_correlations3, by = "Asset") %>%
  rename(static_corr = SP500)

# Plot
tidyverse_rolling_corr3 %>%
  ggplot(aes(x = week, color = Asset)) +
  # Data
  geom_line(aes(y = static_corr), color = "red") +
  geom_line(aes(y = rolling_corr), alpha = 0.5) +
  facet_wrap(~ Asset, ncol = 2, scales = "free_y") +
  # Aesthetics
  scale_color_tq() +
  labs(
    title = "S&P500: 4-Weeks Rolling Correlations, S&P500 vs different assets",
    subtitle = "Relationships are dynamic vs static correlation (red line)",
    x = "", y = "Correlation"
  ) +
  theme_tq() +
  theme(legend.position="none")


```



Er dataen vi har brukt valid i forhold til statistiske regler? 

Hva er t-staten? 
signifikans? 
standardavvik? 
Andre ting?

&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;

```{r message=FALSE, echo=FALSE}

# Plotting. 
df2 %>% 
  ggplot(aes(x=week, y=cumulative, group=Asset)) +
  geom_line(aes(color=Asset))+
  ylab(expression("Return on cumulativ form")) +
  xlab("Date") +
  labs(title = "Logarithmic return on cumulative form 2020",
       subtitle = "",
       caption = "")+theme(plot.title = element_text(hjust = 0.5))

```

&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;


```{r message=FALSE, echo=FALSE}
#define the keywords
keywords=c("Bitcoin")
#set the geographic area: DE = Germany
country=c('')
# Setting time frame
time = ("today+5-y")
#set channels 
channel='web'
# Pulling the data from google
trends = gtrends(keywords, gprop =channel,geo=country, time = time )
#select only interest over time 
time_trend=trends$interest_over_time

time_trend <- time_trend %>% select(date,hits,keyword) %>% rename(Date ="date", Price = "hits", Asset = "keyword") %>% filter(Date>= "2016-01-04")


#####################################################################

BTC2<-BTC %>% mutate(Asset="Bitcoin Price")
BTC2$week <- as.POSIXct(paste(BTC2$week, BTC2$Time), format="%Y-%m-%d")

# Making monthly data
BTC2$month <- floor_date(BTC2$week, "month")
# Grouping then new variable month and taking the mean to get monthly price
BTC2 <- BTC2 %>%
  group_by(month) %>%
  summarize(mean = mean(Price))

# Making numeric
time_trend$Price <- as.numeric(time_trend$Price)

# Making monthly data
time_trend$month <- floor_date(time_trend$Date, "month")

# Grouping then new variable week and taking the mean to get monthly price
time_trend <- time_trend %>%
  group_by(month) %>%
  summarize(mean = mean(Price))

# Making google search fit the scale on the graph
time_trend<-time_trend %>%mutate(mean= mean*200 )
# Naming assets
time_trend <- time_trend %>% mutate(Asset = "Google Search ")
# Naming assets
BTC2 <- BTC2 %>% mutate(Asset = "Bitcoin Price")

# Changing name on time_trend from date to week
names(time_trend)[names(time_trend) == 'Date'] <- 'week' 
# Making data long
test26<- rbind(BTC2,time_trend)
# Plotting
vs<-test26 %>% 
  ggplot(aes(x=month, y=mean, group=Asset)) +
  geom_line(aes(color=Asset))+
  ylab(expression("Bitcoin Price $")) +
  xlab("Date") +
  labs(title = "Bitcoin Price vs Searches at Google",
       subtitle = "Graph:Monthly data",
       caption = "")+theme(plot.title = element_text(hjust = 0.5))
vs<-vs+ scale_y_continuous(sec.axis = sec_axis(~./200, name = ""))
vs

```



### Final Analysis
What did you learn about the data? How did you answer the questions? How can you justify your answers?

&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;


We where not able to run this Rmarkdown in the online edition for some unknown reason.

It can be a problem kniting this Rmarkdown on the weekendays and until the stock market closes on Monday, since there will be added new data during the weekend for Bitcoin and Ethereum and not for the traditional markets since those are closed. That means that it will be added one more observation for the crypto assets and can cause errors kniting. 

### Kilder 

###### Quandl API - gull priser
https://www.quandl.com/data/LBMA/GOLD-Gold-Price-London-Fixing

###### Bitcoin
https://finance.yahoo.com/quote/BTC-USD/history?period1=1446768000&period2=1604620800&interval=1mo&filter=history&frequency=1mo&includeAdjustedClose=true

###### Ethereum
https://finance.yahoo.com/quote/ETH-USD/history?period1=1446768000&period2=1604620800&interval=1mo&filter=history&frequency=1mo&includeAdjustedClose=true

###### Gull
https://finance.yahoo.com/quote/GC%3DF/history?period1=1446768000&period2=1604620800&interval=1mo&filter=history&frequency=1mo&includeAdjustedClose=true

###### Vix
https://finance.yahoo.com/quote/%5EVIX/history?period1=1446768000&period2=1604620800&interval=1mo&filter=history&frequency=1mo&includeAdjustedClose=true

###### S&P500
https://finance.yahoo.com/quote/%5EGSPC/history?period1=1446768000&period2=1604620800&interval=1mo&filter=history&frequency=1mo&includeAdjustedClose=true


